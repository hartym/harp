#! /usr/bin/env python3

import asyncio
import sys

from harp import ProxyFactory, get_logger, get_server_adapter

logger = get_logger(__name__)


class Factory(ProxyFactory):
    def configure(self):
        self.load("harp.contrib.sqlalchemy_storage")


if __name__ == "__main__":
    try:
        proxy = Factory()
        adapter = get_server_adapter(proxy)
    except Exception as exc:
        logger.fatal(exc, exc_info=True)
        sys.exit(1)
    asyncio.run(adapter.serve())
